function rgb2hex(t){return t=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),""+hex(t[1])+hex(t[2])+hex(t[3])}function hex(t){return isNaN(t)?"00":hexDigits[(t-t%16)/16]+hexDigits[t%16]}var colorcodeArray=[],hexDigits=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");$.ajax({async:!1,url:global_host_address+"settings/getColors.do",dataType:"json",success:function(t){for(var o=0,e=0;e<t.d.details.length;e++)colorcodeArray[o]=rgb2hex(t.d.details[e]),colorcodeArray[o+1]="userColor"+(e+1),o+=2;colorcodeArray=colorcodeArray.concat(defaultFroalaColors)}}),tinymce.PluginManager.add("textcolor",function(t){function o(o){var e;return t.dom.getParents(t.selection.getStart(),function(t){var r;(r=t.style["forecolor"==o?"color":"background-color"])&&(e=r)}),e}function e(o){var e,r,a=[];for(r=["000000","Black","993300","Burnt orange","333300","Dark olive","003300","Dark green","003366","Dark azure","000080","Navy Blue","333399","Indigo","333333","Very dark gray","800000","Maroon","FF6600","Orange","808000","Olive","008000","Green","008080","Teal","0000FF","Blue","666699","Grayish blue","808080","Gray","FF0000","Red","FF9900","Amber","99CC00","Yellow green","339966","Sea green","33CCCC","Turquoise","3366FF","Royal blue","800080","Purple","999999","Medium gray","FF00FF","Magenta","FFCC00","Gold","FFFF00","Yellow","00FF00","Lime","00FFFF","Aqua","00CCFF","Sky blue","993366","Red violet","FFFFFF","White","FF99CC","Pink","FFCC99","Peach","FFFF99","Light yellow","CCFFCC","Pale green","CCFFFF","Pale cyan","99CCFF","Light sky blue","CC99FF","Plum"],colorcodeArray=t.settings.textcolor_map||colorcodeArray,colorcodeArray=t.settings[o+"_map"]||colorcodeArray,e=0;e<colorcodeArray.length;e+=2)a.push({text:colorcodeArray[e+1],color:"#"+colorcodeArray[e]});return a}function r(){function o(t,o){var e="transparent"==t;return'<td class="mce-grid-cell'+(e?" mce-colorbtn-trans":"")+'"><div id="'+b+"-"+F++ +'" data-mce-color="'+(t?t:"")+'" role="option" tabIndex="-1" style="'+(t?"background-color: "+t:"")+'" title="'+tinymce.translate(o)+'">'+(e?"&#215;":"")+"</div></td>"}var r,a,l,c,n,d,u,g,m=this,b=m._id,F=0;for(g=m.settings.origin,r=e(g),r.push({text:tinymce.translate("No color"),color:"transparent"}),l='<table class="mce-grid mce-grid-border mce-colorbutton-grid" role="list" cellspacing="0"><tbody>',c=r.length-1,d=0;d<s[g];d++){for(l+="<tr>",n=0;n<i[g];n++)u=d*i[g]+n,u>c?l+="<td></td>":(a=r[u],l+=o(a.color,a.text));l+="</tr>"}if(t.settings.color_picker_callback){for(l+='<tr><td colspan="'+i[g]+'" class="mce-custom-color-btn"><div id="'+b+'-c" class="mce-widget mce-btn mce-btn-small mce-btn-flat" role="button" tabindex="-1" aria-labelledby="'+b+'-c" style="width: 100%"><button type="button" role="presentation" tabindex="-1">'+tinymce.translate("Custom...")+"</button></div></td></tr>",l+="<tr>",n=0;n<i[g];n++)l+=o("","Custom color");l+="</tr>"}return l+="</tbody></table>"}function a(o,e){t.undoManager.transact(function(){t.focus(),t.formatter.apply(o,{value:e}),t.nodeChanged()})}function l(o){t.undoManager.transact(function(){t.focus(),t.formatter.remove(o,{value:null},null,!0),t.nodeChanged()})}function c(e){function r(t){u.hidePanel(),u.color(t),a(u.settings.format,t)}function c(){u.hidePanel(),u.resetColor(),l(u.settings.format)}function n(t,o){t.style.background=o,t.setAttribute("data-mce-color",o)}var s,d,u=this.parent();d=u.settings.origin,tinymce.DOM.getParent(e.target,".mce-custom-color-btn")&&(u.hidePanel(),t.settings.color_picker_callback.call(t,function(t){var o,e,a,l=u.panel.getEl().getElementsByTagName("table")[0];for(o=tinymce.map(l.rows[l.rows.length-1].childNodes,function(t){return t.firstChild}),a=0;a<o.length&&(e=o[a],e.getAttribute("data-mce-color"));a++);if(a==i[d])for(a=0;a<i[d]-1;a++)n(o[a],o[a+1].getAttribute("data-mce-color"));n(e,t),r(t)},o(u.settings.format))),s=e.target.getAttribute("data-mce-color"),s?(this.lastId&&document.getElementById(this.lastId).setAttribute("aria-selected",!1),e.target.setAttribute("aria-selected",!0),this.lastId=e.target.id,"transparent"==s?c():r(s)):null!==s&&u.hidePanel()}function n(){var t=this;t._color?a(t.settings.format,t._color):l(t.settings.format)}var i,s;s={forecolor:t.settings.forecolor_rows||t.settings.textcolor_rows||5,backcolor:t.settings.backcolor_rows||t.settings.textcolor_rows||5},i={forecolor:t.settings.forecolor_cols||t.settings.textcolor_cols||8,backcolor:t.settings.backcolor_cols||t.settings.textcolor_cols||8},t.addButton("forecolor",{type:"colorbutton",tooltip:"Text color",format:"forecolor",panel:{origin:"forecolor",role:"application",ariaRemember:!0,html:r,onclick:c},onclick:n}),t.addButton("backcolor",{type:"colorbutton",tooltip:"Background color",format:"hilitecolor",panel:{origin:"backcolor",role:"application",ariaRemember:!0,html:r,onclick:c},onclick:n})});