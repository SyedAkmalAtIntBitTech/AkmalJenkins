var urldata=[{text:"Select Url",value:""}];$.ajax({url:getHost()+"getAllUserMarketingProgramsBySessionUserId",method:"Get",dataType:"json",contentType:"application/json",mimeType:"application/json",success:function(t){for(var e=t,n=0;n<t.length;n++)urldata.push({text:e[n].text,value:t[n].href})}}),tinymce.PluginManager.add("link",function(t){function e(e){return function(){var n=t.settings.link_list;"string"==typeof n?tinymce.util.XHR.send({url:n,success:function(t){e(tinymce.util.JSON.parse(t))}}):"function"==typeof n?n(e):e(n)}}function n(t,e,n){function l(t,n){return n=n||[],tinymce.each(t,function(t){var i={text:t.text||t.title};t.menu?i.menu=l(t.menu):(i.value=t.value,e&&e(i)),n.push(i)}),n}return l(t,n||[])}function l(e){function l(t){var e=f.find("#text");(!e.value()||t.lastControl&&e.value()==t.lastControl.text())&&e.value(t.control.text()),f.find("#href").value(t.control.value())}function i(e){var n=[];return tinymce.each(t.dom.select("a:not([href])"),function(t){var l=t.name||t.id;l&&n.push({text:l,value:"#"+l,selected:-1!=e.indexOf("#"+l)})}),n.length?(n.unshift({text:"None",value:""}),{name:"anchor",type:"listbox",label:"Anchors",values:n,onselect:l}):void 0}function a(){!c&&0===b.text.length&&d&&this.parent().parent().find("#text")[0].value(this.value())}function s(e){var n=e.meta||{};m&&m.value(t.convertURL(this.value(),"href")),tinymce.each(e.meta,function(t,e){f.find("#"+e).value(t)}),n.text||a.call(this)}function o(t){var e=_.getContent();if(/</.test(e)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(e)||-1==e.indexOf("href=")))return!1;if(t){var n,l=t.childNodes;if(0===l.length)return!1;for(n=l.length-1;n>=0;n--)if(3!=l[n].nodeType)return!1}return!0}var r,u,c,f,d,g,m,x,v,h,p,y,k,b={},_=t.selection,C=t.dom;r=_.getNode(),u=C.getParent(r,"a[href]"),d=o(),b.text=c=u?u.innerText||u.textContent:_.getContent({format:"text"}),b.href=u?C.getAttrib(u,"href"):"",u?b.target=C.getAttrib(u,"target"):t.settings.default_link_target&&(b.target=t.settings.default_link_target),(k=C.getAttrib(u,"rel"))&&(b.rel=k),(k=C.getAttrib(u,"class"))&&(b["class"]=k),(k=C.getAttrib(u,"title"))&&(b.title=k),d&&(g={name:"text",type:"textbox",size:40,label:"Text to display",onchange:function(){b.text=this.value()}}),e&&(m={type:"listbox",label:"Link list",values:n(e,function(e){e.value=t.convertURL(e.value||e.url,"href")},[{text:"None",value:""}]),onselect:l,value:t.convertURL(b.href,"href"),onPostRender:function(){m=this}}),t.settings.target_list!==!1&&(t.settings.target_list||(t.settings.target_list=[{text:"None",value:""},{text:"New window",value:"_blank"}]),h={name:"target",type:"listbox",label:"Target",values:n(t.settings.target_list)}),t.settings.rel_list&&(v={name:"rel",type:"listbox",label:"Rel",values:n(t.settings.rel_list)}),t.settings.link_class_list&&(p={name:"class",type:"listbox",label:"Class",values:n(t.settings.link_class_list,function(e){e.value&&(e.textStyle=function(){return t.formatter.getCssText({inline:"a",classes:[e.value]})})})}),t.settings.link_title!==!1&&(y={name:"title",type:"textbox",label:"Title",value:b.title}),t.settings.customUrls_list=[{text:"select url",value:""},{text:"google",value:"http:google.com"},{text:"gmail",value:"http:gmail.com"}],t.settings.customUrls_list=urldata,x={name:"CustomURl",type:"listbox",label:"CustomUrl",values:n(t.settings.customUrls_list),onselect:function(){var t=this.parent().parent();f.find("#href").value(JSON.parse(JSON.stringify(t)).CustomURl)}},f=t.windowManager.open({title:"Insert link",data:b,body:[x,{name:"href",type:"filepicker",filetype:"file",size:40,autofocus:!0,label:"Url",onchange:s,onkeyup:a},g,y,i(b.href),m,v,h,p],onSubmit:function(e){function n(e,n){var l=t.selection.getRng();tinymce.util.Delay.setEditorTimeout(t,function(){t.windowManager.confirm(e,function(e){t.selection.setRng(l),n(e)})})}function l(){var e={href:i,target:b.target?b.target:null,rel:b.rel?b.rel:null,"class":b["class"]?b["class"]:null,title:b.title?b.title:null};u?(t.focus(),d&&b.text!=c&&("innerText"in u?u.innerText=b.text:u.textContent=b.text),C.setAttribs(u,e),_.select(u),t.undoManager.add()):d?t.insertContent(C.createHTML("a",e,C.encode(b.text))):t.execCommand("mceInsertLink",!1,e)}var i;return b=tinymce.extend(b,e.data),(i=b.href)?i.indexOf("@")>0&&-1==i.indexOf("//")&&-1==i.indexOf("mailto:")?void n("The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",function(t){t&&(i="mailto:"+i),l()}):t.settings.link_assume_external_targets&&!/^\w+:/i.test(i)||!t.settings.link_assume_external_targets&&/^\s*www[\.|\d\.]/i.test(i)?void n("The URL you entered seems to be an external link. Do you want to add the required http:// prefix?",function(t){t&&(i="http://"+i),l()}):void l():void t.execCommand("unlink")}})}t.addButton("link",{icon:"link",tooltip:"Insert/edit link",shortcut:"Meta+K",onclick:e(l),stateSelector:"a[href]"}),t.addButton("unlink",{icon:"unlink",tooltip:"Remove link",cmd:"unlink",stateSelector:"a[href]"}),t.addShortcut("Meta+K","",e(l)),t.addCommand("mceLink",e(l)),this.showDialog=l,t.addMenuItem("link",{icon:"link",text:"Insert/edit link",shortcut:"Meta+K",onclick:e(l),stateSelector:"a[href]",context:"insert",prependToContext:!0})});