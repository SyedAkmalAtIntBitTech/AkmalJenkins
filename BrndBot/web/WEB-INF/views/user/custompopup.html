<!DOCTYPE html>
<!--
Copyright 2015 Intbit Technologies. This software and documentation contains
confidential and proprietary information that is owned by Intbit
Technologies. Unauthorized use and distribution are strictly prohibited.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" type="text/css" href="../css/general_1.css" />
        <script src="../js/jquery-1.11.3.min.js" type="text/javascript"></script> 
        <link href="css/style_detail_overlay-1.css" rel="stylesheet" type="text/css"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script src="../js/jquery-1.11.3.min.js" type="text/javascript"></script> 
        <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.7/angular.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.7/angular-route.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.0/angular-animate.min.js"></script>
        <script src="../js/configurations.js"></script>
        <link href="../css/jquerygrowl.css" rel="stylesheet" type="text/css"/>
        <script src="../js/jquerygrowl.js" type="text/javascript"></script>
        <script>
            var appp = angular.module("imgPopup", []);
            appp.directive('customOnChange', function () {
                return {
                    restrict: 'A',
                    link: function (scope, element, attrs) {
                        var onChangeFunc = scope.$eval(attrs.customOnChange);
                        element.bind('change', onChangeFunc);
                    }
                };
            });

            appp.controller("imgPopupController", function ($scope, $http, $q) {
                $scope.imageToBeUploaded = '../images/uploadPhoto.svg';
                $scope.imageSelected = 'gallery-item-wrap-selected-true';
                $scope.imageUnSelect = 'gallery-item-wrap-selected';
                var imageurl = "";
                var deffered = $q.defer();
                $scope.getAllCompanyImages = function () {
                    $scope.fadeClass = 'fadeClass';
                    $scope.showUploadImage = false;
                    $scope.showUserImages = true;
                    $scope.chooseImage = true;
                    $http.get(getHost() + "companyImages/get", "", "").then(function (getData) {
                        $scope.datalists = getData.data.d.details;
                        $scope.companyId = getData.data.d.details[0].fkCompanyId.companyId;
                        deffered.resolve(getData.data);
                    });
                };
                $scope.selectImageToPost = function (imageName, imageFrom, companyId, id) {
                    angular.element(document.getElementsByClassName('gallery-item-wrap-selected-true')).addClass('gallery-item-wrap-selected').removeClass('gallery-item-wrap-selected-true');
                    angular.element(document.getElementById(id)).removeClass('gallery-item-wrap-selected').addClass('gallery-item-wrap-selected-true');
                    imageurl = "/BrndBot/downloadImage?imageType=GALLERY&imageName=" + imageName + "&companyId=" + companyId + "";
                    $("#imageDiv").val(imageurl);
                };
                $scope.selectImageFromGallery = function (popmpMode) {
                    if (popmpMode) {
                        $scope.showUploadImage = false;
                        $scope.showUserImages = true;
                    } else {
                        $scope.showUserImages = false;
                        $scope.showUploadImage = true;
                    }
                };
                $scope.showImageUploadPopup = function ()
                {
                    $("#filesToUpload").trigger("click");
                };
                $scope.uploadFile = function () {
                    var deffered = $q.defer();
                    var fd = new FormData();
                    fd.append('file', event.target.files[0]);
                    $http.post(getHost() + "images/save", fd, {
                        transformRequest: angular.identity,
                        headers: {'Content-Type': undefined}
                    }).then(function (putData) {
                        deffered.resolve(putData.data);
                        $scope.getAllCompanyImages();
                    }, function (error) {
                    });
                };

            });
        </script>
        <style>
            .thumb{
                width:140px;
                height:140px;
                margin:6px;
                float:left;
            }
            .mce-rank-button button {
                color: red !important;
            }
        </style>
    </head>
    <body ng-app="imgPopup" class="center-pop-ups" ng-controller="imgPopupController">
        <input type="hidden" id="imageDiv">

        <div  class="center-pop-ups " id="fade" ng-class="fadeClass">

            <div class="center-pop-ups" style="height:100vh;">
                <div class="modal-pane modal-pane-width-full mbPopup ">
                    <div ng-init="getAllCompanyImages()">
                        <div class="modal-pane-header-wrap">
                            <div class="upload-photo-button reg-button gray-button" ng-click="showImageUploadPopup()">Upload an Image</div>
                        </div>
                        <div class="pop-up-inner-gallery" ng-show="chooseImage">
                            <div class="imageGallery-inner-popup">
                                <div class="imageUpload-container">
                                    <div class="browse-button">
                                        <input type="file"  hidden="" id="filesToUpload" custom-on-change="uploadFile"/>
                                    </div>
                                </div>                     
                            </div>
                            <div class="full-height-modal-pane-content-wrap modal-pane-content-social-sequence" ng-show="showUserImages" >
                                <div class="gallery-image-wrap {{images.companyImagesId}}">
                                    <div class="gallery-image-card" ng-repeat="images in datalists"  ng-click="selectImageToPost(images.imageName, 'gallery', companyId)">
                                        <img  class="gallery-image" id="{{images.companyImagesId}}"  src="/BrndBot/downloadImage?imageType=GALLERY&imageName={{images.imageName}}&companyId={{companyId}}" alt="{{images.imageName}}"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
